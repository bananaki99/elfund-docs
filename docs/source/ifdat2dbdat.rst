Κανόνες μετατροπής IFDAT σε DAT
===============================

Κάθε συμπληρωμένος πίνακας IFDAT μετατρέπεται σε έναν η περισσότερους πίνακες DAT.

Στις εγγραφές όλων των πινάκων θα προστεθούν τα εξής πεδία:

#. SOURCE_USER: Το αναγνωριστικό (username) του χρήστη που έκανε την υποβολή.
#. SOURCE_ORG: To ID του οργανισμού που έκανε την υποβολή (πχ. '030')
#. SOURCE_TYPE: Παίρνει την τιμή 'OTR' όταν τα στοιχεια προέρχονται από τον πίνακα REF.CNTRPRTY και την τιμή 'SDR' για τα στοιχεία που προέρχονται από όλους τους άλλους πίνακες πλην του  REF.CNTRPRTY.
#. TIMESTAMP: Χρονοσφραγίδα εισαγωγής των στοιχείων στη βάση.

Ο πίνακας IFDAT:ACC.DPST μεταφέρεται στον πίνακα DAT:ACC.ASST_DPST χωρίς καμία άλλη αλλαγή/προσθήκη.

Ο πίνακας IFDAT:ACC.ASST_DBT μεταφέρεται στον πίνακα DAT:ACC.ASST_DBT χωρίς καμία άλλη αλλαγή/προσθήκη.

Ο πίνακας IFDAT:ACC.ASST_LN μεταφέρεται στον πίνακα DAT:ACC.ASST_LN χωρίς καμία άλλη αλλαγή/προσθήκη.

Ο πίνακας IFDAT:ACC.SHR μεταφέρεται στον πίνακα DAT:ACC.SHR χωρίς καμία άλλη αλλαγή/προσθήκη.

Ο πίνακας IFDAT:ACC.DER μεταφέρεται στον πίνακα DAT:ACC.DER χωρίς καμία άλλη αλλαγή/προσθήκη.

Ο πίνακας IFDAT:ACC.ASST_NN_FNNCL μεταφέρεται στον πίνακα DAT:ACC.ASST_NN_FNNCL χωρίς καμία άλλη αλλαγή/προσθήκη.

Ο πίνακας IFDAT:ACC.LBLT_DBT μεταφέρεται στον πίνακα DAT:ACC.LBLT_DBT χωρίς καμία άλλη αλλαγή/προσθήκη.

Ο πίνακας IFDAT:ACC.LBLT_LN μεταφέρεται στον πίνακα DAT:ACC.LBLT_LN χωρίς καμία άλλη αλλαγή/προσθήκη.

Ο πίνακας IFDAT:ACC.LBLT_RMNNG μεταφέρεται στον πίνακα DAT:ACC.LBLT_RMNNG χωρίς καμία άλλη αλλαγή/προσθήκη.

Ο πίνακας IFDAT:ACC.HLDR μεταφέρεται στον πίνακα DAT:ACC.HLDR χωρίς καμία άλλη αλλαγή/προσθήκη.

Ο πίνακας IFDAT:ACC.KEY μεταφέρεται στον πίνακα DAT:ACC.KEY χωρίς καμία άλλη αλλαγή/προσθήκη.

Ο πίνακας IFDAT:ACC.FEE μεταφέρεται στον πίνακα DAT:ACC.FEE χωρίς καμία άλλη αλλαγή/προσθήκη.

Ο πίνακας IFDAT:ACC.DRGTN μεταφέρεται στον πίνακα DAT:ACC.IFDAT_DRGTN χωρίς καμία άλλη αλλαγή/προσθήκη.

Από ένα αντίγραφο του πίνακα IFDAT:REF_RA διαγράφονται οι μετρήσεις LEI_ID, TAX_ID, NBR_ID και αν το αποτέλεσμα περιέχει συμπληρωμένες *μετρήσεις* μεταφέρεται στον πίνακα DAT:REF.ORG. 

Από ένα αντίγραφο του πίνακα IFDAT:REF_FND διαγράφονται οι μετρήσεις LEI_ID, TAX_ID, NBR_ID και αν το αποτέλεσμα περιέχει συμπληρωμένες *μετρήσεις* μεταφέρεται στον πίνακα DAT:REF.ORG. Οπότε μεταφέρονται τα πεδία ID, DT_BRTH, DT_CLS, SPLT_FRM, MRGD_WTH.

Όσον αφορά τις μετρήσεις LEI_ID, TAX_ID, NBR_ID  αυτές μεταφέρονται στον πίνακα REF.ORG_ALIAS με τον τροπο που καθορίζεται στη συνέχεια.
#. Γίνεται έλεγχος αν το ID (LEI_ID, TAX_ID, NBR_ID) έχει συνδεθεί με ESCB-ID άλλης οντότητας. 
Σε περίπτωση που το ID υπάρχει σε άλλη οντοτητα δημιουργείται απορριπτικό σφάλμα στο αρχείο ΑΠΑ οπότε δεν υφίσταται καμία διαδικασια μετατροπής.
Ο έλεγχος αυτος πιθανότατα θα γίνει σε σχέση με κάποιον πίνακα όπου θα υπάρχουν όλες οι συνδέσεις LID-RID.  
Ο έλεγχος θα περιγραφεί με λεπτομέρεια στο σημείο όπου θα περιγραφούν οι authoritative έλεγχοι.

#. Τα ids μεταφερονται στη διάσταση LID με τον εξής τρόπο:
   #. Κάθε LEI_ID για να μπει στον πίνακα REF.ORG_ALIAS θα πρέπει να του προστεθεί το προθεμα 'L'. Το ίδιο ισχυει και αν θέλουμε να αρχικοποιήσουμε το πεδίο. Σε αυτή την περίπτωση θα καταχωρηθεί η τιμή 'L.'
   #. Κάθε TAX_ID για να μπει στον πίνακα REF.ORG_ALIAS θα πρέπει να του προστεθεί το προθεμα 'T' συν το 'GR' συν το τον κωδικό TAX_ID. Το ίδιο ισχύει και αν θέλουμε να αρχικοποιήσουμε το πεδίο. Σε αυτή την περίπτωση θα καταχωρηθεί η τιμή 'Τ.'
   #. Κάθε NBR_ID για να μπει στον πίνακα REF.ORG_ALIAS θα πρέπει να του προστεθεί το προθεμα 'Β' συν το 'GR' συν το NBR_ID. Το ίδιο ισχύει και αν θέλουμε να αρχικοποιήσουμε το πεδίο. Σε αυτή την περίπτωση θα καταχωρηθεί η τιμή 'Β.'

   Αποσαφηνίζεται ότι το πεδίο αρχικοποιείται όταν στην αντίστοιχη μέτρηση (LEI_ID, TAX_ID, NBR_ID) υπάρχει η τιμή  '.'

#. Το ID του πίνακα REF.FND θα μεταφερθεί στη στήλη RID του πίνακα REF.ORG_ALIAS.

#. Η μέτρηση ALIAS_OF του πίνακα  REF.ORG_ALIAS θα συμπληρώνεται:
   -  με την τιμή 'Τ' όταν προσθέτουμε μία νέα εγγραφή (Σημειωση: Νέα εγγραφή προστίθεται ακόμα και σε περίπτωση που το συγκεκριμένο LID είναι ήδη συνδεδεμένο με το RID)
   -  με την τιμή 'F' όταν καταργούμε μία εγγραφή (όταν βρούμε άλλο *ίδιου τύπου* LID στο συγκεκριμένο RID) και 
   -  με '.' όταν θέλουμε να διαγράψουμε μία εγγραφή χωρίς να προσθέσουμε νέα (αρχικοποίηση). 

#. Η ιδιότητα ALIAS_OF.STATUS συμπληρώνεται με τιμή 'Α' εκτός και αν στη μέτρηση (LEI_ID, TAX_ID, NBR_ID) έχει μπει η τιμή αρχικοποίησης οπότε αρχικοποιείται και αυτό το πεδίο με την κατάλληλη τιμή αρχικοποίησης.

Μετά από όλες τις προσαρμογές το περιεχόμενο του πίνακα IFDAT:REF_FND αναμένουμε να έχει μεταφερθεί όλο στη βάση DAT.

----
Μετατροπή πίνακα IFDAT.FND_DNMC στη δομή DAT.

#. Από ένα αντίγραφο του πίνακα διαγράφονται όλες οι μετρήσεις πλην της RPRTD_BY, MNGD_BY και UNDR_UMBRLL_BY. Οι δύο αυτές μετρήσεις μαζί με τις διαστάσεις του πίνακα IFDAT.FND_DNMC (που είναι οι: ID, VLD_FRM, VLD_T) μεταφέρονται στον πίνακα DAT: REF.ORG2ORG με τον εξής τρόπο:
  - Στη διάσταση LID του πίνακα REF.ORG2ORG μπαίνει το ESCB code που υπάρχει στις μετρήσεις RPRTD_BY, MNGD_BY και UNDR_UMBRLL_BY. Δημιουργούνται τόσες γραμμές όσα και τα διαφορετικά ESCB codes.
    Αν για παραδειγμα στο μοντέλο IFDAT έχουμε:
    +--+--------+------+--------+---------+--------------+
    |ID| VLD_FRM| VLD_T|RPRTD_BY| MNGD_BY |UNDR_UMBRLL_BY| 
    +==+========+======+========+=========+==============+
    |A|21/01/2025||B|B|C|
   Στο μοντέλο DBDAT θα δημιουργηθούν οι γραμμές
    +---+---+--------+------+---------+-----------+--------------+
    |LID|RID| VLD_FRM| VLD_T|MNGMNT_OF| UMBRLL_OF |IFDAT_RPRTR_OF| 
    +===+========+====+========+=========+==============+
    |A|B|21/01/2025||T||T|
    |-|-|----------|--|--|--|
    |A|C|21/01/2025|||T||

#. Από ένα αντίγραφο του πίνακα διαγράφονται όλες οι μετρήσεις πλην των 
NM, NM_LTN, NM_SHRT, CNTRY_RSDNC, STRT, STRT_LTN, CTY, CTY_LTN, PSTL_CD, URL, EMAIL, IS_LSTD, IS_INCTV, IS_UNDR_LQDTN, INSTTTNL_SCTR_CNTRL, IS_FOF, IS_ETF, IS_PEF, CRRNCY. 
Οι μετρήσεις NM, NM_LTN, NM_SHRT, CNTRY_RSDNC, STRT, STRT_LTN, CTY, CTY_LTN, PSTL_CD, URL, EMAIL, IS_LSTD, IS_INCTV, IS_UNDR_LQDTN, INSTTTNL_SCTR_CNTRL, IS_FOF, IS_ETF, IS_PEF, CRRNCY μαζί με τις διαστάσεις του πίνακα IFDAT.FND_DNMC (που είναι οι: ID, VLD_FRM, VLD_T) μεταφέρονται στις αντίστοιχες μετρήσεις του πίνακα DAT: REF.ORG_DYNMC (και το ID ή αντικαθιστούμε με το ESCB_ID?).
Οι μετρήσεις LGL_TYP, INVSTMNT_PLCY, DSTRBTN_PLCY, INVSTR_TYP, GRN_TYP, STRTGY, GGRPHCL_FCS, BND_FCS, RL_ESTT_TYP μεταφέρονται στον πίνακα στις μετρήσεις FND_LGL_TYP, FND_INVSTMNT_PLCY, FND_DSTRBTN_PLCY, FND_INVSTR_TYP, FND_GRN_TYP, FND_STRTGY, FND_GGRPHCL_FCS, FND_BND_FCS, FND_RL_ESTT_TYP αντίστοιχα.
Από τη μεταβλητή INVSTMNT_PLCY του πίνακα IFDAT: REF.FND_DYNMC θα υπολογίζεται και η μέτρηση INSTTTNL_SCTR του πίνακα DAT: REF.ORG_DYNMC οποία θα παίρνει την τιμή S123 όταν το INVSTMNT_PLCY είναι 'MMF', '.' όταν το INVSTMNT_PLCY δεν έχει τιμή ή έχει την τιμή αρχικοποίησης και S124 σε όλες τις άλλες περιπτώσεις.

#. 
TBC
